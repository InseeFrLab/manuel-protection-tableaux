<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>manuel - 5&nbsp; Présentation des outils</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06_fiches_pratiques.html" rel="next">
<link href="./04_analyser_une_demande.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05_les_outils.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Présentation des outils</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">manuel</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_regles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Règles</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_notions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Notions principales à connaître</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_analyser_une_demande.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Comment analyser une demande ?</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_les_outils.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Présentation des outils</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_fiches_pratiques.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Fiches pratiques</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_annexes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Annexes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_lexique.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">08_lexique.html</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#tau-argus" id="toc-tau-argus" class="nav-link active" data-scroll-target="#tau-argus"><span class="header-section-number">5.1</span> Tau-argus</a>
  <ul class="collapse">
  <li><a href="#présentation-générale" id="toc-présentation-générale" class="nav-link" data-scroll-target="#présentation-générale"><span class="header-section-number">5.1.1</span> Présentation générale</a></li>
  <li><a href="#les-différentes-algorithmes-du-secret-secondaire" id="toc-les-différentes-algorithmes-du-secret-secondaire" class="nav-link" data-scroll-target="#les-différentes-algorithmes-du-secret-secondaire"><span class="header-section-number">5.1.2</span> Les différentes algorithmes du secret secondaire</a></li>
  <li><a href="#avantages-et-inconvénients" id="toc-avantages-et-inconvénients" class="nav-link" data-scroll-target="#avantages-et-inconvénients"><span class="header-section-number">5.1.3</span> Avantages et inconvénients</a></li>
  </ul></li>
  <li><a href="#package-rtauargus" id="toc-package-rtauargus" class="nav-link" data-scroll-target="#package-rtauargus"><span class="header-section-number">5.2</span> Package rtauargus</a>
  <ul class="collapse">
  <li><a href="#objectifs" id="toc-objectifs" class="nav-link" data-scroll-target="#objectifs"><span class="header-section-number">5.2.1</span> Objectifs</a></li>
  <li><a href="#principales-fonctionnalités" id="toc-principales-fonctionnalités" class="nav-link" data-scroll-target="#principales-fonctionnalités"><span class="header-section-number">5.2.2</span> Principales fonctionnalités</a></li>
  <li><a href="#où-trouver-la-documentation" id="toc-où-trouver-la-documentation" class="nav-link" data-scroll-target="#où-trouver-la-documentation"><span class="header-section-number">5.2.3</span> Où trouver la documentation ?</a></li>
  </ul></li>
  <li><a href="#comment-débugger" id="toc-comment-débugger" class="nav-link" data-scroll-target="#comment-débugger"><span class="header-section-number">5.3</span> Comment débugger ?</a>
  <ul class="collapse">
  <li><a href="#les-principales-erreurs" id="toc-les-principales-erreurs" class="nav-link" data-scroll-target="#les-principales-erreurs"><span class="header-section-number">5.3.1</span> Les principales erreurs</a></li>
  <li><a href="#savoir-lire-les-différents-types-de-fichiers-spécifiques-à-tau-argus" id="toc-savoir-lire-les-différents-types-de-fichiers-spécifiques-à-tau-argus" class="nav-link" data-scroll-target="#savoir-lire-les-différents-types-de-fichiers-spécifiques-à-tau-argus"><span class="header-section-number">5.3.2</span> Savoir lire les différents types de fichiers spécifiques à Tau-Argus</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Présentation des outils</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="tau-argus" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="tau-argus"><span class="header-section-number">5.1</span> Tau-argus</h2>
<section id="présentation-générale" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="présentation-générale"><span class="header-section-number">5.1.1</span> Présentation générale</h3>
<p>Tau-Argus est la logiciel de référence en Europe en termes de pose de secret. Il permet de calculer le secret primaire et secondaire ou de faire des arrondis contrôlés. Le développement, la maintenance et le support de Tau-Argus sont réalisés par un groupe d’experts européens et est coordonné par CBS (l’institut national de statistiques des Pays-Bas). C’est un logiciel libre et open source (https://github.com/sdcTools/tauargus) utilisable via une interface graphique. Le logiciel</p>
</section>
<section id="les-différentes-algorithmes-du-secret-secondaire" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="les-différentes-algorithmes-du-secret-secondaire"><span class="header-section-number">5.1.2</span> Les différentes algorithmes du secret secondaire</h3>
<p>Plusieurs algorithmes sont implémentes dans Tau-Argus pour gérer le secret secondaire. La <strong>méthode Hypercube</strong> permet un traitement séquentiel des cases sous secret primaire, en minimisant le coût. Dans le cas d’une hiérarchie alors elle traite les sous-tableaux indépendamment. Il s’agit d’une méthode heuristique et rapide. Elle a l’avantage de proposer un masque rapidement mais celui-ci n’est pas le plus optimal. La <strong>méthode Optimal</strong> met en place une minimisation globale du coût, respecte les règles des intervalles. C’est une méthode souvent très lente. Enfin, la <strong>méthode Modular</strong> éclate le problème en différents sous-tableaux sur lesquels elle applique la méthode Optimal. Les variables doivent être hiérarchiques (<em>pourquoi ?</em>). C’est une méthode assez rapide que l’on utilise dans la plupart des cas.</p>
</section>
<section id="avantages-et-inconvénients" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="avantages-et-inconvénients"><span class="header-section-number">5.1.3</span> Avantages et inconvénients</h3>
<p>Tau-Argus comporte de nombreux avantages, il s’agit d’un outil qui fait référence, performant sur la partie pose de secret et il est maintenu régulièrement. Cependant, il a des limites. En effet, l’interface est assez fouillis, il renvoie des bugs et des erreurs pas toujours facile à comprendre et corriger, enfin la reproductibilité des opérations est limitée.</p>
</section>
</section>
<section id="package-rtauargus" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="package-rtauargus"><span class="header-section-number">5.2</span> Package rtauargus</h2>
<p>Bien que l’usage de standard de Tau-Argus se fasse par une interface graphique, la prise en main n’est pas aisée. Ainsi, un package R a été développé à l’Insee pour travailler avec Tau-Argus depuis R : <code>rtauargus</code>. Il permet de bénéficier des avantages de Tau-Argus tout en limitant les inconvénients.</p>
<section id="objectifs" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="objectifs"><span class="header-section-number">5.2.1</span> Objectifs</h3>
<p>Le but de ce package est de faciliter la prise en main de Tau-Argus. Ainsi, il permet de poser le secret secondaire avec Tau-Argus sans l’ouvrir et gérer de grosses demandes.</p>
</section>
<section id="principales-fonctionnalités" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="principales-fonctionnalités"><span class="header-section-number">5.2.2</span> Principales fonctionnalités</h3>
<p>Le package a deux fonctionnalités principales : il permet de poser le secret directement sur les tableaux ou à partir des microdonnées.Le fonctionnement général du package est le suivant : création de l’ensemble des fichiers dans les formats attendus par Tau-Argus, lance Tau-Argus, puis récupération des résultats dans R.</p>
<p>La démarche utilisée à la DMRG consiste à poser le secret primaire “manuellement”, c’est-à-dire sans faire appel à Tau-Argus et d’ensuite poser le secret secondaire à l’aide de la fonction <code>tab_rtauargus()</code> pour protéger un seul tableau et <code>tab_multi_manager()</code> pour protéger plusieurs tableaux.</p>
</section>
<section id="où-trouver-la-documentation" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="où-trouver-la-documentation"><span class="header-section-number">5.2.3</span> Où trouver la documentation ?</h3>
<p>Le documentation est disponible en ligne : https://inseefrlab.github.io/rtauargus/</p>
</section>
</section>
<section id="comment-débugger" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="comment-débugger"><span class="header-section-number">5.3</span> Comment débugger ?</h2>
<section id="les-principales-erreurs" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="les-principales-erreurs"><span class="header-section-number">5.3.1</span> Les principales erreurs</h3>
<section id="les-limites-de-tau-argus" class="level4" data-number="5.3.1.1">
<h4 data-number="5.3.1.1" class="anchored" data-anchor-id="les-limites-de-tau-argus"><span class="header-section-number">5.3.1.1</span> Les limites de Tau-Argus</h4>
<p><strong>Le nombre de variables de ventilation</strong></p>
<p><strong>La taille des nombres</strong></p>
<p><strong>Les limites du fichier hiérarchique</strong></p>
<p><strong>Le nombre de modalités</strong></p>
<p><strong>Les algorithmes de secret secondaire</strong></p>
</section>
<section id="les-codes-derreur-dans-tau-argus" class="level4" data-number="5.3.1.2">
<h4 data-number="5.3.1.2" class="anchored" data-anchor-id="les-codes-derreur-dans-tau-argus"><span class="header-section-number">5.3.1.2</span> Les codes d’erreur dans Tau-Argus</h4>
<p>Cette partie n’est pas exhaustive mais recense les codes d’erreurs que nous avons rencontré en utilisant Tau-Argus.</p>
<p>Les différentes causes possibles du message “code not in codelist” sont les suivantes :</p>
<ul>
<li>Une modalité d’une variable hiérarchique est présente dans la table mais pas dans le fichier hiérarchique associé</li>
<li>Les noms de colonnes spécifiés pour le paramètre specify_tables de la fonction tab_arb() ne sont pas dans le même ordre que dans le tableau</li>
</ul>
<p>Le message d’erreur “illegal status in transition” est lié à l’apriori, voici les différentes causes possibles :</p>
<ul>
<li>Une cellule possède deux <em>status</em> contradictoires dans le fichier d’apriori (ex : A01,s et A01,u). La cellule ne pouvant pas avoir deux <em>status</em> à la fois, Tau-Argus ne peut pas comprendre le statut de la cellule</li>
<li>Une cellule avec une valeur nulle et un effecitf nul est renseignée comme unsafe (u)</li>
</ul>
<p>Les différentes causes possibles du message d’erreur “error making totals” sont :</p>
<ul>
<li>On a écrit dans le batch <readtable> et donc les totaux dans le tableau ne sont pas égaux à la somme des éléments qui le composent, autrement dit la table n’est pas additive</readtable></li>
<li>On écrit dans le batch <readtable> 1 et donc Tau-Argus reconstitue lui-même les totaux. Cela vient généralement du problème des feuilles uniques décrit dans la partie précédente.</readtable></li>
</ul>
<p>Le message d’erreur “HiTaS: couldn’t load JJ-routines” est spécifique à l’aglorithme Modular, en voici les différentes causes possibles :</p>
<ul>
<li>La taille maximale pour un nombre à été dépassée (<strong>faire référence</strong>)</li>
<li>Le problème paraît insoluble pour Modular (<strong>faire référence</strong>)</li>
<li>N.B : parfois “couldn’t load JJ-routines” (sans HiTaS devant) renvoie à un problème du type “code not in codelist”</li>
</ul>
<p>Le message d’erreur “no optimal solution found JJ not loaded” est spécifique à l’aglorithme Optimal, en voici les différentes causes possibles :</p>
<ul>
<li>La taille maximale pour un nombre à été dépassée (<strong>faire référence</strong>)</li>
<li>Le problème paraît insoluble pour Optimal (<strong>faire référence</strong>)</li>
</ul>
<p>Le message d’erreur “the hypercube could not be applied See file PROTO002” est spécifique à l’aglorithme HyperCube, en voici les différentes causes possibles :</p>
<ul>
<li>La taille maximale pour un nombre à été dépassée (<strong>faire référence</strong>)</li>
<li>Le problème paraît insoluble pour HyperCube (<strong>faire référence</strong>)</li>
</ul>
<p>Pour le message ” error in modular suppression procedure” il faut bien faire attention que c’est le message d’erreur présent dans le batch :</p>
<ul>
<li>Généralement quand c’est l’unique message d’erreur, alors c’est que Modular a tourné pendant quelques minutes puis a atteint une limite de mémoire dans Tau-Argus</li>
<li><strong>faire référence</strong> et tester avec un autre algorithme</li>
</ul>
</section>
</section>
<section id="savoir-lire-les-différents-types-de-fichiers-spécifiques-à-tau-argus" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="savoir-lire-les-différents-types-de-fichiers-spécifiques-à-tau-argus"><span class="header-section-number">5.3.2</span> Savoir lire les différents types de fichiers spécifiques à Tau-Argus</h3>
<p>Fichiers rtauargus :</p>
<ul>
<li><code>.rda</code> : fichier de métadonnées pour Tau-Argus</li>
<li><code>.tab</code> : fichier donné à Tau-Argus, il est décirt par .rda, les colonnes sont dans l’ordre des nom dans .rda</li>
<li><code>.hst</code> : fichier de l’apriori, avec rtauargus on pose le secret primaire en amont, on ne demande pas à Tau-Argus de le faire. Dans ce fichier on a à la fois le secret de départ, le “protection level” et les coûts (c)</li>
<li><code>.arb</code> : fichier executé dans la console windows, il est interprété par Tau-Argus. Autrment dit, ce sont une liste de commandes données à Tau-Argus</li>
</ul>
<p>Fichiers Tau-Argus :</p>
<ul>
<li><code>.txt</code> : journal d’exécution, il n’écrase pas les exécutions ainsi on peut voir toutes les exécutions jamais faites avec Tau-Argus</li>
<li><code>.csv</code> : données d’entrée avec deux nouvelles colonnes. La colonne <strong>status</strong> à trois modalités : “B” = secret apriori (u), “D” = secret secondaire, “V” = cellules valides, diffusables. La colonne <em>dom</em> renvoie à la dominance dans les cas de secret de dominance où le pourcentage de dominance est nécessaire, néanmoins étant donné notre utilisation de Tau-Argus (pose du secret primaire “manuellement”) cette colonne ne nous intéresse pas.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04_analyser_une_demande.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Comment analyser une demande ?</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06_fiches_pratiques.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Fiches pratiques</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>