<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.545">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Manuel de protection des tableaux - 6&nbsp; Présentation des outils</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapters/annexes/regles.html" rel="next">
<link href="./05_fiches_pratiques.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05_fiches_pratiques.html">En pratique</a></li><li class="breadcrumb-item"><a href="./06_expert.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Présentation des outils</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Manuel de protection des tableaux</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_notions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Notions principales à connaître</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">La pose de secret</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_secret_un_tableau.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Poser le secret sur un tableau</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_analyser_une_demande.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Comment analyser une demande ?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_secret_tableaux_lies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Poser le secret sur plusieurs tableaux liés</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">En pratique</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_fiches_pratiques.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Fiches pratiques</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_expert.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Présentation des outils</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Annexes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapters/annexes/regles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Règles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapters/annexes/manipuler_les_listes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Manipuler les listes avec <code>R</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Plan</h2>
   
  <ul>
  <li><a href="#tau-argus" id="toc-tau-argus" class="nav-link active" data-scroll-target="#tau-argus"><span class="header-section-number">6.1</span> Tau-argus</a>
  <ul>
  <li><a href="#présentation-générale" id="toc-présentation-générale" class="nav-link" data-scroll-target="#présentation-générale"><span class="header-section-number">6.1.1</span> Présentation générale</a></li>
  <li><a href="#les-différents-algorithmes-du-secret-secondaire" id="toc-les-différents-algorithmes-du-secret-secondaire" class="nav-link" data-scroll-target="#les-différents-algorithmes-du-secret-secondaire"><span class="header-section-number">6.1.2</span> Les différents algorithmes du secret secondaire</a></li>
  <li><a href="#avantages-et-inconvénients" id="toc-avantages-et-inconvénients" class="nav-link" data-scroll-target="#avantages-et-inconvénients"><span class="header-section-number">6.1.3</span> Avantages et inconvénients</a></li>
  </ul></li>
  <li><a href="#package-rtauargus" id="toc-package-rtauargus" class="nav-link" data-scroll-target="#package-rtauargus"><span class="header-section-number">6.2</span> Package rtauargus</a>
  <ul>
  <li><a href="#objectifs" id="toc-objectifs" class="nav-link" data-scroll-target="#objectifs"><span class="header-section-number">6.2.1</span> Objectifs</a></li>
  <li><a href="#principales-fonctionnalités" id="toc-principales-fonctionnalités" class="nav-link" data-scroll-target="#principales-fonctionnalités"><span class="header-section-number">6.2.2</span> Principales fonctionnalités</a></li>
  <li><a href="#où-trouver-la-documentation" id="toc-où-trouver-la-documentation" class="nav-link" data-scroll-target="#où-trouver-la-documentation"><span class="header-section-number">6.2.3</span> Où trouver la documentation ?</a></li>
  </ul></li>
  <li><a href="#les-limites-de-tau-argus" id="toc-les-limites-de-tau-argus" class="nav-link" data-scroll-target="#les-limites-de-tau-argus"><span class="header-section-number">6.3</span> Les limites de Tau-Argus</a>
  <ul>
  <li><a href="#le-nombre-de-variables-de-ventilation" id="toc-le-nombre-de-variables-de-ventilation" class="nav-link" data-scroll-target="#le-nombre-de-variables-de-ventilation"><span class="header-section-number">6.3.1</span> Le nombre de variables de ventilation</a></li>
  <li><a href="#les-valeurs-trop-élevées" id="toc-les-valeurs-trop-élevées" class="nav-link" data-scroll-target="#les-valeurs-trop-élevées"><span class="header-section-number">6.3.2</span> Les valeurs trop élevées</a></li>
  <li><a href="#les-limites-du-fichier-hiérarchique" id="toc-les-limites-du-fichier-hiérarchique" class="nav-link" data-scroll-target="#les-limites-du-fichier-hiérarchique"><span class="header-section-number">6.3.3</span> Les limites du fichier hiérarchique</a></li>
  <li><a href="#le-nombre-de-modalités" id="toc-le-nombre-de-modalités" class="nav-link" data-scroll-target="#le-nombre-de-modalités"><span class="header-section-number">6.3.4</span> Le nombre de modalités</a></li>
  <li><a href="#les-algorithmes-de-secret-secondaire" id="toc-les-algorithmes-de-secret-secondaire" class="nav-link" data-scroll-target="#les-algorithmes-de-secret-secondaire"><span class="header-section-number">6.3.5</span> Les algorithmes de secret secondaire</a></li>
  </ul></li>
  <li><a href="#les-codes-derreur-dans-tau-argus" id="toc-les-codes-derreur-dans-tau-argus" class="nav-link" data-scroll-target="#les-codes-derreur-dans-tau-argus"><span class="header-section-number">6.4</span> Les codes d’erreur dans Tau-Argus</a></li>
  <li><a href="#savoir-lire-les-différents-types-de-fichiers-spécifiques-à-tau-argus" id="toc-savoir-lire-les-différents-types-de-fichiers-spécifiques-à-tau-argus" class="nav-link" data-scroll-target="#savoir-lire-les-différents-types-de-fichiers-spécifiques-à-tau-argus"><span class="header-section-number">6.5</span> Savoir lire les différents types de fichiers spécifiques à Tau-Argus</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05_fiches_pratiques.html">En pratique</a></li><li class="breadcrumb-item"><a href="./06_expert.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Présentation des outils</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-presentationoutils" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Présentation des outils</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="tau-argus" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="tau-argus"><span class="header-section-number">6.1</span> Tau-argus</h2>
<section id="présentation-générale" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="présentation-générale"><span class="header-section-number">6.1.1</span> Présentation générale</h3>
<p>Tau-Argus est la logiciel de référence en Europe en termes de pose de secret. Il permet de calculer le secret primaire et secondaire ou de faire des arrondis contrôlés. Le développement, la maintenance et le support de Tau-Argus sont réalisés par un groupe d’experts européens et est coordonné par CBS (l’institut national de statistiques des Pays-Bas). C’est un logiciel libre et open source (<a href="https://github.com/sdcTools/tauargus" class="uri">https://github.com/sdcTools/tauargus</a>) utilisable via une interface graphique.</p>
</section>
<section id="les-différents-algorithmes-du-secret-secondaire" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="les-différents-algorithmes-du-secret-secondaire"><span class="header-section-number">6.1.2</span> Les différents algorithmes du secret secondaire</h3>
<p>Plusieurs algorithmes sont implémentes dans Tau-Argus pour gérer le secret secondaire. La <strong>méthode Hypercube</strong> permet un traitement séquentiel des cases sous secret primaire, en minimisant le coût. Dans le cas d’une hiérarchie, elle traite les sous-tableaux indépendamment. Il s’agit d’une méthode heuristique et rapide. Elle a l’avantage de proposer un masque rapidement mais celui-ci n’est pas le plus optimal. La <strong>méthode Optimal</strong> met en place une minimisation globale du coût et respecte les intervalles de protection. C’est une méthode souvent très lente. Enfin, la <strong>méthode Modular</strong> éclate le problème en différents sous-tableaux sur lesquels elle applique la méthode Optimal. Les variables doivent être hiérarchiques (<em>pourquoi ?</em>). C’est une méthode assez rapide que l’on utilise dans la plupart des cas.</p>
</section>
<section id="avantages-et-inconvénients" class="level3" data-number="6.1.3">
<h3 data-number="6.1.3" class="anchored" data-anchor-id="avantages-et-inconvénients"><span class="header-section-number">6.1.3</span> Avantages et inconvénients</h3>
<p>Tau-Argus comporte de nombreux avantages, il s’agit d’un outil qui fait référence, performant sur la partie pose de secret et il est maintenu régulièrement. Cependant, il a des limites. En effet, l’interface est assez fouillis, il renvoie des bugs et des erreurs pas toujours facile à comprendre et corriger, enfin la reproductibilité des opérations est limitée.</p>
</section>
</section>
<section id="package-rtauargus" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="package-rtauargus"><span class="header-section-number">6.2</span> Package rtauargus</h2>
<p>Bien que l’usage standard de Tau-Argus se fasse par une interface graphique, la prise en main n’est pas aisée. Ainsi, un package R a été développé à l’Insee pour travailler avec Tau-Argus depuis R : <code>rtauargus</code>. Il permet de bénéficier des avantages de Tau-Argus tout en limitant les inconvénients.</p>
<section id="objectifs" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="objectifs"><span class="header-section-number">6.2.1</span> Objectifs</h3>
<p>Le but de ce package est de faciliter la prise en main de Tau-Argus. Ainsi, il permet de poser le secret secondaire avec Tau-Argus sans l’ouvrir et gérer de grosses demandes.</p>
</section>
<section id="principales-fonctionnalités" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="principales-fonctionnalités"><span class="header-section-number">6.2.2</span> Principales fonctionnalités</h3>
<p>Le package a deux fonctionnalités principales : il permet de poser le secret directement sur les tableaux ou à partir des microdonnées. Le fonctionnement général du package est le suivant : création de l’ensemble des fichiers dans les formats attendus par Tau-Argus, lancement de Tau-Argus puis récupération des résultats dans R.</p>
<p>La démarche utilisée à la DMRG consiste à poser le secret primaire “manuellement”, c’est-à-dire sans faire appel à Tau-Argus et d’ensuite poser le secret secondaire à l’aide de la fonction <code>tab_rtauargus()</code> pour protéger un seul tableau et <code>tab_multi_manager()</code> pour protéger plusieurs tableaux.</p>
</section>
<section id="où-trouver-la-documentation" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="où-trouver-la-documentation"><span class="header-section-number">6.2.3</span> Où trouver la documentation ?</h3>
<p>Le documentation est disponible en ligne : <a href="https://inseefrlab.github.io/rtauargus/" class="uri">https://inseefrlab.github.io/rtauargus/</a></p>
</section>
</section>
<section id="les-limites-de-tau-argus" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="les-limites-de-tau-argus"><span class="header-section-number">6.3</span> Les limites de Tau-Argus</h2>
<section id="le-nombre-de-variables-de-ventilation" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="le-nombre-de-variables-de-ventilation"><span class="header-section-number">6.3.1</span> Le nombre de variables de ventilation</h3>
<p>Actuellement <span class="math inline">\(\tau\)</span>-Argus tolère au maximum 4 variables de ventilation par tableau. Cependant, pour 4 variables de ventilation un warning apparaît, <span class="math inline">\(\tau\)</span>-Argus ne garantit pas une protection totale de la table. Effectuer un contrôle de cohérence sur le secret pour un tableau avec 4 dimensions est très complexe.</p>
<p>Pour pallier cette limitation, le package rtauargus permet de transformer des tableaux de 4 ou 5 dimensions en tableaux de 3 dimensions. Pour cela, il suffit de renseigner l’argument <strong><code>split_tab = TRUE</code></strong> lors de l’appel de <strong><code>tab_multi_manager()</code></strong> ou <strong><code>tab_rtauargus()</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>dtMasque <span class="ot">&lt;-</span> <span class="fu">tab_rtauargus</span>(<span class="at">tabular =</span> dtTableau</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>              , <span class="at">explanatory_vars =</span> <span class="fu">c</span>(<span class="st">"NAF"</span>, <span class="st">"GEO"</span>, <span class="st">"CJ"</span>, <span class="st">"TREFF"</span>, <span class="st">"TRAGE"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>              , <span class="at">files_name =</span> <span class="st">"tableauSecretise"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>              , <span class="at">dir_name =</span> <span class="st">"c:/"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>              , <span class="at">totcode =</span> <span class="fu">c</span>(<span class="st">"Total"</span>, <span class="st">"Total"</span>, <span class="st">"Total"</span>, <span class="st">"Total"</span>, <span class="st">"Total"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>              , <span class="at">secret_var =</span> <span class="st">"is_secret_prim"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>              , <span class="at">value =</span> <span class="st">"VALUE"</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>              , <span class="at">freq =</span> <span class="st">"FREQ"</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>              , <span class="at">maxscore =</span> <span class="st">"MAX"</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>              , <span class="at">split_tab =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour aller plus loin, vous trouverez une vignette très complète sur le sujet dans le package rtauargus. (<code>rtauargus/doc/split_tab_fr.html</code>)</p>
</section>
<section id="les-valeurs-trop-élevées" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2" class="anchored" data-anchor-id="les-valeurs-trop-élevées"><span class="header-section-number">6.3.2</span> Les valeurs trop élevées</h3>
<p><span class="math inline">\(\tau\)</span>-Argus ne parvient pas à traiter un tableau s’il rencontre une cellule d’une valeur trop élevée.Dans le cas où une celulle du tableau viendrait à dépasser <span class="math inline">\(10^{12}\)</span>, un message d’erreur apparaîtra lors de la pose du secret secondaire. Afin d’éviter ce genre de problème, il est conseillé de regarder si le plus gros total du tableau dépasse <span class="math inline">\(10^{12}\)</span>, le cas échéant nous recommandons de diviser la valeur de votre tableau par une puissance de 10 adéquate. Cependant cela implique de faire attention à plusieurs choses :</p>
<ul>
<li>Traiter le secret primaire dans le fichier d’apriori avant d’arrondir les valeurs.</li>
<li>S’assurer qu’aucune valeur n’est arrondie à 0, elle ne serait alors plus prise en compte lors du traitement du secret secondaire, dans ce cas il faut forcer un arrondi à 1 minimum.</li>
<li>Si la valeur du plus gros contributeur est encore présente dans la table, l’arrondir avec le même ordre de grandeur que la variable de réponse.</li>
</ul>
<p>A ce jour, aucune limite n’a été constatée en terme de nombre de décimales, la piste reste à explorer. Mais nous recommandons tout de même d’arrondir les valeurs. Dans tous les cas les arrondis n’impacteront que très peu la pose du secret.</p>
</section>
<section id="les-limites-du-fichier-hiérarchique" class="level3" data-number="6.3.3">
<h3 data-number="6.3.3" class="anchored" data-anchor-id="les-limites-du-fichier-hiérarchique"><span class="header-section-number">6.3.3</span> Les limites du fichier hiérarchique</h3>
<p>LE NOMBRE DE CARACTÈRES DES FEUILLES</p>
<p>Au sein d’un fichier <code>.hrc</code>, <span class="math inline">\(\tau\)</span>-Argus a besoin qu’au niveau hiérarchique le plus fin les feuilles aient le même nombre de caractères. Par exemple la hiérarchie suivante renverra un message d’erreur :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>A</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>A01</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>A02</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>A3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La fonction <code>write_hrc2()</code> permet d’ajouter des * dans la hiérarchie et les modalités du tableau afin d’éviter ce genre d’erreurs. Afin que ce soit le plus robuste possible cette transformation est appliquée à tous les niveaux hiérarchiques. Pour l’exemple précédent on obtiendra alors la hiérarchie :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="sc">**</span><span class="er">*</span>A</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>A01</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>A02</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span><span class="er">*</span>A3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>LES FEUILLES UNIQUES</p>
<p>Lors de la reconstitution des totaux de la table par <span class="math inline">\(\tau\)</span>-Argus, on obtient une erreur si la hiérarchie contient ce qu’on va appeler une “feuille unique”. Par exemple dans la hiérarchie :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>A</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>A1</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span><span class="er">@</span>A11</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span><span class="er">@</span>A12</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A1 sera ce qu’on appelle une feuille unique, c’est le seul sous-niveau de A. Ce problème n’est présent que lorsqu’on traite des données tabulées, la solution que nous utilisons actuellement est de créer une feuille fictive dans la hiérarchie. Nous n’avons pas de fonction qui automatise ce traitement actuellement mais nous allons probablement en développer une prochainement (<em>est-ce tjr le cas ou c’est fait automatiquement dans write_hrc2() maintenant ?</em>). La nouvelle hiérarchie sera la suivante :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>A</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>AX</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>A1</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span><span class="er">@</span>A11</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span><span class="er">@</span>A12</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Il n’y a pas besoin de modifier le tableau l’agrégat AX vaudra 0 et le traitement de la table s’effectuera correctement.</p>
</section>
<section id="le-nombre-de-modalités" class="level3" data-number="6.3.4">
<h3 data-number="6.3.4" class="anchored" data-anchor-id="le-nombre-de-modalités"><span class="header-section-number">6.3.4</span> Le nombre de modalités</h3>
<p>Dans <span class="math inline">\(\tau\)</span>-Argus, le nombre de modalités au sein d’un même niveau hiérarchique est limité.</p>
<p>VARIABLE NON HIÉRARCHIQUE</p>
<p>Pour une variable non hiérarchique <span class="math inline">\(\tau\)</span>-Argus ne peut pas traiter plus de 199 modalités (200 en comptabilisant le Total). Par exemple, un tableau au niveau communal avec donc 35 000 communes ne pourra pas être traité directement via <span class="math inline">\(\tau\)</span>-Argus. Les solutions que nous conseillons actuellement sont :</p>
<ul>
<li>De découper le tableau en divers sous-tableau afin de respecter ce nombre de modalités maximum.</li>
<li>D’insérer une variables hiérarchique qui permettra de respecter les critères décrits ci-dessous. Cela implique de traiter les nouveaux niveaux hiérarchiques comme des variables non diffusées.</li>
</ul>
<p>VARIABLE HIÉRARCHIQUE</p>
<p>Pour une variable hiérarchique il faut qu’il y ait moins de 200 modalités par niveau de la hiérarchie. Considérons la hiérarchie Région &gt; Département &gt; Commune, pour que <span class="math inline">\(\tau\)</span>-Argus puisse poser le secret secondaire :</p>
<ul>
<li>Il faut moins de 200 régions.</li>
<li>Dans une région donnée, il faut moins de 200 départements.</li>
<li>Dans un département donné, il faut moins de 200 communes.</li>
</ul>
<p>Cependant, les zonages géographiques français ne respectent pas ces limites.</p>
<p>Dans notre exemple, dans chaque département il y a plus de 200 communes, le traitement hiérarchique tel quel est donc impossible. Une solution envisageable serait de rajouter un niveau hiérarchique en plus afin de réduire le nombre de commune sau même niveau. On peut penser ici par exemple aux cantons puisque qu’un département contient au maximum 43 cantons et un canton contient au maximum 135 communes. On pourrait alors traiter le hiérarchie Région &gt; Département &gt; Canton &gt; Commune. Les cellules concernant les cantons devront être traitées comme des cellules non diffusées et donc être prioritaires au niveau du secret secondaire. C’est-à-dire qu’à choisir on indiquera au programme de secrétiser plutôt un canton que tout autre zonage géographique</p>
</section>
<section id="les-algorithmes-de-secret-secondaire" class="level3" data-number="6.3.5">
<h3 data-number="6.3.5" class="anchored" data-anchor-id="les-algorithmes-de-secret-secondaire"><span class="header-section-number">6.3.5</span> Les algorithmes de secret secondaire</h3>
<p>Dans certains cas assez particuliers, il se peut qu’un algorithme de secret secondaire ne puisse pas trouver de solution au problème en entrée. Étant donné que nous recommandons d’utiliser Modular en priorité, si jamais l’algorithme ne parvient pas à trouver de solution il faut alors tester Optimal puis HyperCube. Si aucun de ces trois algorithmes ne parvient à trouver de solution, cela vient généralement d’une grande table qui contient énormément de secret primaire. Dans ce cas nous recommandons de reconsidérer le problème. Cela vaut-il vraiment la peine de diffuser une table à un niveau aussi fin avec autant de secret primaire ? Il est peut être préférable d’agréger les données afin d’avoir moins de secret primaire.</p>
</section>
</section>
<section id="les-codes-derreur-dans-tau-argus" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="les-codes-derreur-dans-tau-argus"><span class="header-section-number">6.4</span> Les codes d’erreur dans Tau-Argus</h2>
<p>Cette partie n’est pas exhaustive mais recense les codes d’erreurs que nous avons rencontré en utilisant Tau-Argus.</p>
<p>Les différentes causes possibles du message “code not in codelist” sont les suivantes :</p>
<ul>
<li>Une modalité d’une variable hiérarchique est présente dans la table mais pas dans le fichier hiérarchique associé</li>
<li>Les noms de colonnes spécifiés pour le paramètre specify_tables de la fonction tab_arb() ne sont pas dans le même ordre que dans le tableau</li>
</ul>
<p>Le message d’erreur “illegal status in transition” est lié à l’apriori. Voici les différentes causes possibles :</p>
<ul>
<li>Une cellule possède deux <em>status</em> contradictoires dans le fichier d’apriori (ex : A01,s et A01,u). La cellule ne pouvant pas avoir deux <em>status</em> à la fois, Tau-Argus ne peut pas comprendre le statut de la cellule</li>
<li>Une cellule avec une valeur nulle et un effectif nul est renseignée comme unsafe (u)</li>
</ul>
<p>Les différentes causes possibles du message d’erreur “error making totals” sont :</p>
<ul>
<li>On a écrit dans le batch <readtable> et donc les totaux dans le tableau ne sont pas égaux à la somme des éléments qui le composent, autrement dit la table n’est pas additive</readtable></li>
<li>On écrit dans le batch <readtable> 1 et donc Tau-Argus reconstitue lui-même les totaux. Cela vient généralement du problème des feuilles uniques décrit dans la partie précédente.</readtable></li>
</ul>
<p>Le message d’erreur “HiTaS: couldn’t load JJ-routines” est spécifique à l’aglorithme Modular, en voici les différentes causes possibles :</p>
<ul>
<li>La taille maximale pour un nombre à été dépassée (<strong>faire référence</strong>)</li>
<li>Le problème paraît insoluble pour Modular (<strong>faire référence</strong>)</li>
<li>N.B : parfois “couldn’t load JJ-routines” (sans HiTaS devant) renvoie à un problème lié à la hiérarchie (sans doute impossibilité de reconstituter la hiérarhcie à partir des données en entrée)</li>
</ul>
<p>Le message d’erreur “no optimal solution found JJ not loaded” est spécifique à l’aglorithme Optimal, en voici les différentes causes possibles :</p>
<ul>
<li>La taille maximale pour un nombre à été dépassée (<strong>faire référence</strong>)</li>
<li>Le problème paraît insoluble pour Optimal (<strong>faire référence</strong>)</li>
</ul>
<p>Le message d’erreur “the hypercube could not be applied See file PROTO002” est spécifique à l’aglorithme HyperCube, en voici les différentes causes possibles :</p>
<ul>
<li>La taille maximale pour un nombre à été dépassée (<strong>faire référence</strong>)</li>
<li>Le problème paraît insoluble pour HyperCube (<strong>faire référence</strong>)</li>
</ul>
<p>Pour le message ” error in modular suppression procedure” il faut bien faire attention que c’est le message d’erreur présent dans le batch :</p>
<ul>
<li>Généralement quand c’est l’unique message d’erreur, alors c’est que Modular a tourné pendant quelques minutes puis a atteint une limite de mémoire dans Tau-Argus</li>
<li><strong>faire référence</strong> et tester avec un autre algorithme</li>
</ul>
</section>
<section id="savoir-lire-les-différents-types-de-fichiers-spécifiques-à-tau-argus" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="savoir-lire-les-différents-types-de-fichiers-spécifiques-à-tau-argus"><span class="header-section-number">6.5</span> Savoir lire les différents types de fichiers spécifiques à Tau-Argus</h2>
<p>Fichiers en sortie de rtauargus :</p>
<ul>
<li><code>.rda</code> : fichier de métadonnées pour Tau-Argus</li>
<li><code>.tab</code> : fichier donné à Tau-Argus, il est décrit par .rda, les colonnes sont dans l’ordre des nom dans .rda</li>
<li><code>.hst</code> : fichier de l’apriori, avec rtauargus on pose le secret primaire en amont, on ne demande pas à Tau-Argus de le faire. Dans ce fichier on a à la fois le secret de départ, le “protection level” et les coûts (c)</li>
<li><code>.arb</code> : fichier executé dans la console windows, il est interprété par Tau-Argus. Autrement dit, ce sont une liste de commandes données à Tau-Argus</li>
</ul>
<p>Fichiers en sortie de Tau-Argus :</p>
<ul>
<li><code>.txt</code> : journal d’exécution, il n’écrase pas les exécutions ainsi on peut voir toutes les exécutions jamais faites avec Tau-Argus</li>
<li><code>.csv</code> : données d’entrée avec deux nouvelles colonnes. La colonne <strong>status</strong> à trois modalités : “B” = secret apriori (u), “D” = secret secondaire, “V” = cellules valides, diffusables. La colonne <em>dom</em> renvoie à la dominance dans les cas de secret de dominance où le pourcentage de dominance est nécessaire, néanmoins étant donné notre utilisation de Tau-Argus (pose du secret primaire “manuellement”) cette colonne ne nous intéresse pas.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./05_fiches_pratiques.html" class="pagination-link  aria-label=" &lt;span="" pratiques&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Fiches pratiques</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapters/annexes/regles.html" class="pagination-link" aria-label="<span class='chapter-number'>7</span>&nbsp; <span class='chapter-title'>Règles</span>">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Règles</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>